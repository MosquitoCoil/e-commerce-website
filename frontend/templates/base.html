<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %} Base HTML {% endblock %}</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/bootstrap.min.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='bootstrap-icons/font/bootstrap-icons.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/dataTables.bootstrap5.min.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/responsive.bootstrap5.min.css') }}"
    />
    <style>
      .modal-backdrop {
        z-index: 1050 !important;
      }

      .modal {
        z-index: 1060 !important;
      }

      /* hide header when modal open */
      body.modal-open .navbar,
      body.modal-open header {
        display: flex !important;
      }
    </style>
  </head>

  <body>
    {% include "partials/header.html" %} {% with messages =
    get_flashed_messages(with_categories=true) %} {% if messages %}
    <div
      class="toast-container position-fixed top-30 start-50 translate-middle-x p-3"
      style="z-index: 1100"
    >
      {% for category, message in messages %}
      <div
        class="toast align-items-center text-bg-{{ category }} border-0 show mb-2"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
      >
        <div class="d-flex">
          <div class="toast-body">{{ message }}</div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %} {% endwith %}

    <main>
      {% block content %} {% endblock %}
      <!-- Login Modal -->
      <div
        class="modal fade"
        id="loginModal"
        tabindex="-1"
        aria-labelledby="loginModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content shadow-lg">
            <div class="modal-header d-block">
              <div class="w-100 text-center">
                <img
                  src="/static/images/logo2.png"
                  width="130"
                  height="50"
                  alt="Logo"
                />
              </div>
              <h5 class="modal-title ms-2" id="loginModalLabel">Login</h5>
              <button
                type="button"
                class="btn-close position-absolute top-0 end-0 m-2"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form method="POST" action="/login">
                <div class="mb-3">
                  <label for="username" class="form-label"
                    >Username or Email</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="username"
                    name="username"
                    placeholder="Email"
                    required
                  />
                </div>

                <div class="mb-3">
                  <label for="password" class="form-label">Password</label>
                  <input
                    type="password"
                    class="form-control"
                    id="password"
                    name="password"
                    placeholder="Password"
                    required
                  />
                </div>

                <div class="mb-3 form-check">
                  <input
                    type="checkbox"
                    class="form-check-input"
                    id="remember"
                    name="remember"
                  />
                  <label class="form-check-label" for="remember"
                    >Remember me</label
                  >
                </div>

                <button type="submit" class="btn btn-dark w-100">Login</button>

                <p class="text-center mt-3">
                  Donâ€™t have an account?
                  <a
                    href="#"
                    data-bs-toggle="modal"
                    data-bs-target="#registerModal"
                    >Sign Up</a
                  >
                </p>
              </form>
            </div>
          </div>
        </div>
      </div>
      <!-- Register Modal -->
      <div
        class="modal fade"
        id="registerModal"
        tabindex="-1"
        aria-labelledby="registerModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content shadow-lg">
            <div class="modal-header d-block">
              <div class="w-100 text-center">
                <img
                  src="/static/images/logo2.png"
                  width="130"
                  height="50"
                  alt="Logo"
                />
              </div>
              <h5 class="modal-title ms-2" id="registerModalLabel">Sign Up</h5>
              <button
                type="button"
                class="btn-close position-absolute top-0 end-0 m-2"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form method="POST" action="/register">
                <div class="mb-3">
                  <label class="form-label">Firstname</label>
                  <input
                    type="text"
                    class="form-control"
                    name="firstname"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label class="form-label">Lastname</label>
                  <input
                    type="text"
                    class="form-control"
                    name="lastname"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label class="form-label">Address</label>
                  <input type="text" class="form-control" name="address" />
                </div>
                <div class="mb-3">
                  <label class="form-label">Username</label>
                  <input
                    type="text"
                    class="form-control"
                    name="username"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label class="form-label">Password</label>
                  <input
                    type="password"
                    class="form-control"
                    name="password"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="is_admin" class="form-label">Role</label>
                  <select
                    class="form-select form-select-sm"
                    id="is_admin"
                    name="is_admin"
                  >
                    <option value="user" selected>User</option>
                    <option value="admin">Admin</option>
                  </select>
                </div>
                <button type="submit" class="btn btn-dark w-100">
                  Register
                </button>
                <p class="mt-3 text-center">
                  Already have an account?
                  <a
                    href="#"
                    data-bs-toggle="modal"
                    data-bs-target="#loginModal"
                    >Login here</a
                  >
                </p>
              </form>
            </div>
          </div>
        </div>
      </div>
      <!-- Profile Modal -->
      <div
        class="modal fade"
        id="profileModal"
        tabindex="-1"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header d-block">
              <div class="w-100 text-center">
                <img
                  src="/static/images/logo2.png"
                  width="130"
                  height="50"
                  alt="Logo"
                />
              </div>
              <button
                type="button"
                class="btn-close btn-close-white position-absolute top-0 end-0 m-2"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
              <h5 class="modal-title">
                <i class="bi bi-person"></i> My Profile
              </h5>
            </div>
            <div class="modal-body">
              <ul class="list-group">
                <li class="list-group-item">
                  <strong>Username:</strong> {{ user.username }}
                </li>
                <li class="list-group-item">
                  <strong>First Name:</strong> {{ user.firstname }}
                </li>
                <li class="list-group-item">
                  <strong>Address:</strong> {{ user.address }}
                </li>
                <li class="list-group-item">
                  <strong>Account Type:</strong>
                  {% if user.is_admin == "admin" %} Admin {% else %} User {%
                  endif %}
                </li>
                <li class="list-group-item">
                  <strong>Joined:</strong> {{ user.created_at }}
                </li>
              </ul>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" data-bs-dismiss="modal">
                Close
              </button>
              <button
                class="btn btn-primary"
                href="#"
                data-bs-toggle="modal"
                data-bs-target="#editProfileModal"
                id="openEditProfile"
              >
                <i class="bi bi-pencil"></i> Edit Profile
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Edit Profile Modal -->
      <div
        class="modal fade"
        id="editProfileModal"
        tabindex="-1"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header d-block">
              <div class="w-100 text-center">
                <img
                  src="/static/images/logo2.png"
                  width="130"
                  height="50"
                  alt="Logo"
                />
              </div>
              <button
                type="button"
                class="btn-close btn-close-white position-absolute top-0 end-0 m-2"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
              <h5 class="modal-title">
                <i class="bi bi-pencil"></i> Edit Profile
              </h5>
            </div>

            <form
              id="editProfileForm"
              method="POST"
              action="/client/edit-profile"
            >
              <div class="modal-body">
                <div class="mb-3">
                  <label for="username" class="form-label">Username</label>
                  <input
                    type="text"
                    class="form-control"
                    id="username"
                    name="username"
                    value="{{ user.username }}"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="firstname" class="form-label">First Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="firstname"
                    name="firstname"
                    value="{{ user.firstname }}"
                  />
                </div>
                <div class="mb-3">
                  <label for="lastname" class="form-label">Last Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="lastname"
                    name="lastname"
                    value="{{ user.lastname }}"
                  />
                </div>
                <div class="mb-3">
                  <label for="address" class="form-label">Address</label>
                  <input
                    type="text"
                    class="form-control"
                    id="address"
                    name="address"
                    value="{{ user.address }}"
                  />
                </div>
                <div class="mb-3">
                  <label for="password" class="form-label">New Password</label>
                  <input
                    type="password"
                    class="form-control"
                    id="password"
                    name="password"
                    placeholder="Leave blank to keep current password"
                  />
                </div>
                <div class="mb-3">
                  <label for="accountType" class="form-label"
                    >Account Type</label
                  >
                  <select class="form-select" id="accountType" name="is_admin">
                    <option value="user">User</option>
                    <option value="admin">Admin</option>
                  </select>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-success">
                  Save Changes
                </button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </main>
    {% include "partials/footer.html" %} {% block extra_script %}
    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
    <script src="{{ url_for('static', filename='profileModal.js')}}"></script>
    <script>
      // Auto-dismiss flash messages after 4 seconds
      setTimeout(() => {
        const alerts = document.querySelectorAll(".alert");
        alerts.forEach((alert) => {
          let bsAlert = new bootstrap.Alert(alert);
          bsAlert.close();
        });
      }, 4000); // 4000ms = 4 seconds
      document.addEventListener("DOMContentLoaded", () => {
        // Auto-show Bootstrap toasts
        const toastElList = [].slice.call(document.querySelectorAll(".toast"));
        toastElList.forEach((toastEl) => {
          const toast = new bootstrap.Toast(toastEl, { delay: 3000 }); // 3 seconds
          toast.show();
        });

        // Show login modal if ?login=1 in URL
        const params = new URLSearchParams(window.location.search);
        if (params.get("login") === "1") {
          new bootstrap.Modal(document.getElementById("loginModal")).show();
        }

        // Show register modal if ?register=1 in URL
        if (params.get("register") === "1") {
          new bootstrap.Modal(document.getElementById("registerModal")).show();
        }
      });
    </script>
    {% endblock %}
  </body>
</html>
