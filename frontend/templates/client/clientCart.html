{% extends "clientBase.html" %} {% block title %}Home | MyShop{% endblock %} {%
block content %}
<div class="container mt-4">
  <h2>üõí My Cart</h2>
  {% if items %}
  <table
    id="cartTable"
    class="table table-bordered mt-3 align-middle text-center"
  >
    <thead>
      <tr>
        <th>No.</th>
        <th>Image</th>
        <th>Product</th>
        <th>Price</th>
        <th>Quantity</th>
        <th>Total</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for item in items %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>
          {% if item.image %}
          <img
            src="{{ url_for('static', filename='uploads/' ~ item.image) }}"
            width="50"
          />
          {% else %} N/A {% endif %}
        </td>
        <td>{{ item.name }}</td>
        <td>‚Ç±{{ item.price }}</td>
        <td>
          <!-- Minus Button -->
          <form
            action="{{ url_for('editCart.editCart', cart_id=item.id, action='minus') }}"
            method="POST"
            style="display: inline"
          >
            <button class="btn btn-sm btn-outline-dark">-</button>
          </form>

          {{ item.quantity }}

          <!-- Add Button -->
          <form
            action="{{ url_for('editCart.editCart', cart_id=item.id, action='add') }}"
            method="POST"
            style="display: inline"
          >
            <button class="btn btn-sm btn-outline-dark">+</button>
          </form>
        </td>
        <td>‚Ç±{{ item.total }}</td>
        <td>
          <!-- Delete Button -->
          <form
            action="{{ url_for('deleteCart.deleteCart', cart_id=item.id) }}"
            method="POST"
            style="display: inline"
          >
            <button class="btn btn-sm btn-danger">‚ùå Remove</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <div class="text-end">
    <button
      type="submit"
      class="btn btn-dark"
      data-bs-toggle="modal"
      data-bs-target="#checkoutModal"
    >
      Proceed to Checkout
    </button>
  </div>
  {% else %}
  <p>Your cart is empty.</p>
  {% endif %}
</div>

<!-- Checkout Modal -->
<div class="modal fade" id="checkoutModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content p-3">
      <div class="modal-header">
        <h5 class="modal-title">Checkout</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>

      <form action="{{ url_for('checkout.checkout') }}" method="post">
        <div class="modal-body">
          {% if items %}
          <ul class="list-group mb-3">
            {% for item in items %}
            <li
              class="list-group-item d-flex justify-content-between align-items-center"
            >
              <div>
                <strong>{{ item.name }}</strong><br />
                <small>‚Ç±{{ item.price }} x {{ item.quantity }}</small>
              </div>
              <span>‚Ç±{{ item.price * item.quantity }}</span>
            </li>
            {% endfor %}
          </ul>

          <!-- Total -->
          <div class="d-flex justify-content-between">
            <h5>Total</h5>
            <h5>‚Ç±{{ items | sum(attribute='total') }}</h5>
          </div>
          {% else %}
          <p>Your cart is empty.</p>
          {% endif %}
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-dark">
            Proceed to Checkout
          </button>
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %} {% block extra_script %}

<script src="{{ url_for('static', filename='js/jquery-3.7.1.min.js') }}"></script>

<script src="{{ url_for('static', filename='bootstrap.bundle.min.js') }}"></script>

<script src="{{ url_for('static', filename='datatables/js/datatables.min.js') }}"></script>

<script>
  // Init DataTable
  $(document).ready(function () {
    $("#cartTable").DataTable({
      pageLength: 5,
      lengthMenu: [5, 10, 25, 50],
      ordering: true,
      searching: true,
      language: {
        search: '<i class="bi bi-search"></i>',
        searchPlaceholder: "Search items...",
      },
    });
  });
</script>
{% endblock %}
