{% extends "base.html" %} {% block title %}Home | MyShop{% endblock %} {% block
content %}
<div class="container-fluid mt-4">
  <div class="container-sm">
    <h2>ðŸ›’ My Cart</h2>

    {% if items %}
    <table
      id="cartTable"
      class="table table-bordered table-striped align-middle"
    >
      <thead class="table-light text-center">
        <tr>
          <th>No.</th>
          <th>Image</th>
          <th>Product</th>
          <th>Size</th>
          <th>Price</th>
          <th>Quantity</th>
          <th>Total</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>
            {% if item.image %}
            <img
              src="{{ url_for('static', filename='uploads/' ~ item.image) }}"
              width="50"
            />
            {% else %} N/A {% endif %}
          </td>
          <td>{{ item.name }}</td>
          <td>{{ item.size }}</td>
          <td>â‚±{{ item.price }}</td>
          <td>
            <!-- Minus -->
            <form
              action="{{ url_for('editCart.editCart', cart_id=item.id, action='minus') }}"
              method="POST"
              class="d-inline"
            >
              <button class="btn btn-sm btn-outline-dark">-</button>
            </form>

            {{ item.quantity }}

            <!-- Plus -->
            <form
              action="{{ url_for('editCart.editCart', cart_id=item.id, action='add') }}"
              method="POST"
              class="d-inline"
            >
              <button class="btn btn-sm btn-outline-dark">+</button>
            </form>
          </td>
          <td>â‚±{{ item.total }}</td>
          <td>
            <!-- Delete -->
            <form
              action="{{ url_for('deleteCart.deleteCart', cart_id=item.id) }}"
              method="POST"
              class="d-inline"
            >
              <button class="btn btn-sm btn-danger">
                <i class="bi bi-trash"></i> Delete
              </button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Checkout Button -->
    <div class="text-end">
      <button
        type="button"
        class="btn btn-dark mt-2"
        data-bs-toggle="modal"
        data-bs-target="#checkoutModal"
      >
        Proceed to Checkout
      </button>
    </div>
    {% else %}
    <p>Your cart is empty.</p>
    {% endif %}
  </div>
</div>

{% endblock %} {% block extra_script %}
<script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery-3.7.1.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/dataTables.bootstrap5.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/dataTables.responsive.min.js') }}"></script>
<script src="{{ url_for('static', filename='profileModal.js') }}"></script>

<script>
  // Init DataTable
  $(document).ready(() => {
    $("#cartTable").DataTable({
      pageLength: 10,
      lengthMenu: [5, 10, 25, 50],
      ordering: true,
      searching: true,
      responsive: true,
      language: {
        search: '<i class="bi bi-search"></i>',
        searchPlaceholder: "Search items...",
      },
    });
  });

  // Auto-dismiss flash messages after 4s
  setTimeout(() => {
    document.querySelectorAll(".alert").forEach((alert) => {
      new bootstrap.Alert(alert).close();
    });
  }, 4000);

  // Handle login/register modals from URL
  const params = new URLSearchParams(window.location.search);
  if (params.get("login") === "1") {
    new bootstrap.Modal(document.getElementById("loginModal")).show();
  }
  if (params.get("register") === "1") {
    new bootstrap.Modal(document.getElementById("registerModal")).show();
  }

  // Auto-show Bootstrap toasts
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".toast").forEach((toastEl) => {
      new bootstrap.Toast(toastEl, { delay: 3000 }).show();
    });
  });
</script>
{% endblock %}
