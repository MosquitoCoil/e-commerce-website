{% extends "base.html" %} {% block title %}Home | MyShop{% endblock %} {% block
content %}
<div class="container-fluid mt-4">
  <div class="container-sm">
    <h2>üõí My Cart</h2>
    <table id="cartTable" class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th>No.</th>
          <th>Image</th>
          <th>Product</th>
          <th>Size</th>
          <th>Price</th>
          <th>Quantity</th>
          <th>Total</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% if items %} {% for item in items %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>
            {% if item.image %}
            <img
              src="{{ url_for('static', filename='uploads/' ~ item.image) }}"
              width="50"
            />
            {% else %} N/A {% endif %}
          </td>
          <td>{{ item.name }}</td>
          <td>{{ item.size }}</td>
          <td>‚Ç±{{ item.price }}</td>
          <td>
            <form
              action="{{ url_for('editCart.editCart', cart_id=item.id, action='minus') }}"
              method="POST"
              style="display: inline"
            >
              <button class="btn btn-sm btn-outline-dark">-</button>
            </form>

            {{ item.quantity }}

            <!-- Add Button -->
            <form
              action="{{ url_for('editCart.editCart', cart_id=item.id, action='add') }}"
              method="POST"
              style="display: inline"
            >
              <button class="btn btn-sm btn-outline-dark">+</button>
            </form>
          </td>
          <td>‚Ç±{{ item.total }}</td>
          <td>
            <!-- Delete Button -->
            <form
              action="{{ url_for('deleteCart.deleteCart', cart_id=item.id) }}"
              method="POST"
              style="display: inline"
            >
              <button class="btn btn-sm btn-danger">‚ùå Remove</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="text-end">
      <button
        type="submit"
        class="btn btn-dark mt-2"
        data-bs-toggle="modal"
        data-bs-target="#checkoutModal"
      >
        Proceed to Checkout
      </button>
    </div>
    {% else %}
    <p>Your cart is empty.</p>
    {% endif %}
  </div>
</div>

<!-- Checkout Modal -->
<div class="modal fade" id="checkoutModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header d-block">
        <div class="w-100 text-center">
          <img
            src="/static/images/logo2.png"
            width="130"
            height="50"
            alt="Logo"
          />
        </div>
        <button
          type="button"
          class="btn-close position-absolute top-0 end-0 m-2"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
        <h5 class="modal-title">Checkout</h5>
      </div>

      <form action="{{ url_for('checkout.checkout') }}" method="post">
        <div class="modal-body">
          {% if items %}
          <ul class="list-group mb-3">
            {% for item in items %}
            <li
              class="list-group-item d-flex justify-content-between align-items-center"
            >
              <div>
                <strong>{{ item.name }}</strong> <br />
                <small
                  >Size: {{ item.size }} | ‚Ç±{{ item.price }} x {{ item.quantity
                  }}</small
                >
              </div>
              <span>‚Ç±{{ item.price * item.quantity }}</span>
            </li>
            {% endfor %}
          </ul>

          <!-- Total -->
          <div class="d-flex justify-content-between">
            <h5>Total</h5>
            <h5>‚Ç±{{ items | sum(attribute='total') }}</h5>
          </div>
          {% else %}
          <p>Your cart is empty.</p>
          {% endif %}
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-dark">
            Proceed to Checkout
          </button>
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %} {% block extra_script %}

<script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>

<script src="{{ url_for('static', filename='js/jquery-3.7.1.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/dataTables.bootstrap5.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/dataTables.responsive.min.js') }}"></script>
<script src="{{ url_for('static', filename='profileModal.js') }}"></script>

<script>
  // Init DataTable
  $(document).ready(function () {
    $("#cartTable").DataTable({
      pageLength: 10,
      lengthMenu: [5, 10, 25, 50],
      ordering: true,
      searching: true,
      responsive: true, // makes table adapt on mobile
      language: {
        search: '<i class="bi bi-search"></i>',
        searchPlaceholder: "Search items...",
      },
    });
  });

  // Auto-dismiss flash messages after 4 seconds
  setTimeout(() => {
    const alerts = document.querySelectorAll(".alert");
    alerts.forEach((alert) => {
      let bsAlert = new bootstrap.Alert(alert);
      bsAlert.close();
    });
  }, 4000); // 4000ms = 4 seconds
  const loginModal = new URLSearchParams(window.location.search);
  if (loginModal.get("login") === "1") {
    const loginModal = new bootstrap.Modal(
      document.getElementById("loginModal")
    );
    loginModal.show();
  }
  const registerModal = new URLSearchParams(window.location.search);
  if (registerModal.get("register") === "1") {
    const registerModal = new bootstrap.Modal(
      document.getElementById("registerModal")
    );
    registerModal.show();
  }
  document.addEventListener("DOMContentLoaded", () => {
    const toastElList = [].slice.call(document.querySelectorAll(".toast"));
    toastElList.forEach((toastEl) => {
      const toast = new bootstrap.Toast(toastEl, { delay: 3000 }); // auto-hide after 3s
      toast.show();
    });
  });
</script>
{% endblock %}
