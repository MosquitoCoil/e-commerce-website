{% extends "base.html" %} {% block title %}Home | MyShop{% endblock %} {% block
content %}
<div class="container-fluid mt-4">
  <div class="container-sm">
    <h2><i class="bi bi-box-seam"></i> My Orders</h2>

    {% if orders %}
    <table id="orderTable" class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th>No.</th>
          <th>Order ID</th>
          <th>Total</th>
          <th>Date</th>
          <th>Action</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ order.id }}</td>
          <td>₱{{ "%.2f"|format(order.total) }}</td>
          <td>
            {{ order.created_at.strftime('%Y-%m-%d %H:%M') if order.created_at
            else '' }}
          </td>
          <td>
            <button
              class="btn btn-sm btn-dark"
              data-bs-toggle="modal"
              data-bs-target="#orderModal{{ order.id }}"
            >
              View Details
            </button>
          </td>
          <td>
            {% if order.status == "Pending" %}
            <span class="btn btn-sm btn-warning">{{ order.status }}</span>
            {% elif order.status == "Processing" %}
            <span class="btn btn-sm btn-primary">{{ order.status }}</span>
            {% elif order.status == "Delivered" %}
            <span class="btn btn-sm btn-dark">{{ order.status }}</span>
            {% elif order.status == "Completed" %}
            <span class="btn btn-sm btn-success">{{ order.status }}</span>
            {% elif order.status == "Cancelled" %}
            <span class="btn btn-sm btn-danger">{{ order.status }}</span>
            {% elif order.status == "Received" %}
            <span class="btn btn-sm btn-success"
              ><i class="bi bi-check"></i> {{ order.status }}</span
            >
            {% else %}
            <span class="btn btn-sm btn-secondary">{{ order.status }}</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p>You have no orders yet.</p>
    {% endif %}

    <!-- Purchase History -->
    <div class="container mt-5">
      <h2><i class="bi bi-bag-check"></i> Purchase History</h2>
      {% if purchases %}
      <table class="table table-bordered table-striped">
        <thead class="table-dark">
          <tr>
            <th>Order ID</th>
            <th>Product</th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Total</th>
            <th>Received At</th>
          </tr>
        </thead>
        <tbody>
          {% for p in purchases %}
          <tr>
            <td>{{ p.order_id }}</td>
            <td>{{ p.product_name }}</td>
            <td>{{ p.quantity }}</td>
            <td>₱{{ "%.2f"|format(p.price) }}</td>
            <td>₱{{ "%.2f"|format(p.total) }}</td>
            <td>
              {{ p.received_at.strftime('%Y-%m-%d %H:%M') if p.received_at else
              '' }}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="text-muted">No purchase history yet.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %} {% block extra_script %}
<script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery-3.7.1.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/dataTables.bootstrap5.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/dataTables.responsive.min.js') }}"></script>
<script src="{{ url_for('static', filename='profileModal.js') }}"></script>

<script>
  $(document).ready(() => {
    $("#orderTable").DataTable({
      pageLength: 10,
      lengthMenu: [5, 10, 25, 50],
      ordering: true,
      searching: true,
      language: {
        search: '<i class="bi bi-search"></i>',
        searchPlaceholder: "Search orders...",
      },
    });
  });

  // Auto-dismiss flash messages
  setTimeout(() => {
    document.querySelectorAll(".alert").forEach((alert) => {
      new bootstrap.Alert(alert).close();
    });
  }, 4000);

  // Handle login/register modals
  const params = new URLSearchParams(window.location.search);
  if (params.get("login") === "1") {
    new bootstrap.Modal(document.getElementById("loginModal")).show();
  }
  if (params.get("register") === "1") {
    new bootstrap.Modal(document.getElementById("registerModal")).show();
  }

  // Auto-show toasts
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".toast").forEach((toastEl) => {
      new bootstrap.Toast(toastEl, { delay: 3000 }).show();
    });
  });
</script>
{% endblock %}
