{% extends "adminBase.html" %} {% block title %}Manage Products{% endblock %} {%
block content %}
<div class="container-fluid mt-4">
  <div class="container-sm">
    <h2>Existing Products</h2>

    <!-- Add Product button -->
    <button
      class="btn btn-dark mb-3"
      data-bs-toggle="modal"
      data-bs-target="#addProduct"
    >
      <i class="bi bi-plus"></i> Add Product
    </button>

    <table
      id="productTable"
      class="table table-bordered table-striped align-middle"
    >
      <thead class="table-dark text-center">
        <tr>
          <th>No.</th>
          <th>Name</th>
          <th>Description</th>
          <th>Price</th>
          <th>Stock</th>
          <th>Image</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for p in products %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ p.name }}</td>
          <td>{{ p.description }}</td>
          <td>â‚±{{ "%.2f"|format(p.price) }}</td>
          <td>
            <button
              class="btn btn-sm btn-secondary"
              data-bs-toggle="modal"
              data-bs-target="#manageStock{{ p.id }}"
            >
              Manage Stock
            </button>
          </td>
          <td>
            {% if p.image %}
            <img
              src="{{ url_for('static', filename='uploads/' ~ p.image) }}"
              width="50"
              alt="Product Image"
            />
            {% else %} N/A {% endif %}
          </td>
          <td>
            <button
              class="btn btn-sm btn-primary"
              data-bs-toggle="modal"
              data-bs-target="#editProduct{{ p.id }}"
            >
              <i class="bi bi-pencil"></i> Edit
            </button>
            <button
              class="btn btn-sm btn-danger"
              data-bs-toggle="modal"
              data-bs-target="#deleteProduct{{ p.id }}"
            >
              <i class="bi bi-trash"></i> Delete
            </button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %} {% block extra_script %}
<script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery-3.7.1.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/dataTables.bootstrap5.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/dataTables.responsive.min.js') }}"></script>

<script>
  $(document).ready(function () {
    $("#productTable").DataTable({
      pageLength: 10,
      lengthMenu: [5, 10, 25, 50],
      ordering: true,
      columnDefs: [{ orderable: false, targets: [6] }], // disable sorting on Action column
      responsive: true,
      language: {
        search: '<i class="bi bi-search"></i>',
        searchPlaceholder: "Search products...",
      },
    });
  });

  // Auto-dismiss flash messages
  setTimeout(() => {
    document.querySelectorAll(".alert").forEach((alert) => {
      let bsAlert = new bootstrap.Alert(alert);
      bsAlert.close();
    });
  }, 4000);

  // Toast messages
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".toast").forEach((toastEl) => {
      const toast = new bootstrap.Toast(toastEl, {
        delay: 3000,
        autohide: true,
      });
      toast.show();
    });
  });
</script>
{% endblock %}
