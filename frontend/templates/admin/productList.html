{% extends "adminBase.html" %} {% block title %} Manage Products {% endblock %} {%
block content %}

<div class="container mt-4">
  <h2>Existing Products</h2>
  <!-- Add Product button -->
  <button class="btn btn-dark mb-3" data-bs-toggle="modal" data-bs-target="#addProduct">
    <i class="bi bi-plus"></i> Add Product
  </button>
  <table id="productTable" class="table table-bordered table-striped">
    <thead class="table-dark">
      <tr>
        <th>No.</th>
        <th>Name</th>
        <th>Description</th>
        <th>Price</th>
        <th>Stock</th>
        <th>Image</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for p in products %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ p.name }}</td>
        <td>{{ p.description }}</td>
        <td>â‚±{{ "%.2f"|format(p.price) }}</td>
        <td>{{ p.stock }}</td>
        <td>
          {% if p.image %}
          <img src="{{ url_for('static', filename='uploads/' ~ p.image) }}" width="50" />
          {% else %} N/A {% endif %}
        </td>
        <td>
          <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#editProduct{{ p.id }}">
            <i class="bi bi-pencil"></i> Edit
          </button>
          <button class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#deleteProduct{{ p.id }}">
            <i class="bi bi-trash"></i> Delete
          </button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Add Product Modal -->
<div class="modal fade" id="addProduct" tabindex="-1" aria-labelledby="addProductLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addProductLabel">Add Product</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="POST" enctype="multipart/form-data" action="{{ url_for('addProduct.addProduct')}}">
          <div class="mb-3">
            <label class="form-label">Name</label>
            <input type="text" class="form-control" name="name" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea class="form-control" name="description" rows="3"></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Price</label>
            <input type="number" class="form-control" name="price" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Stock</label>
            <input type="number" class="form-control" name="stock" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Image</label>
            <input type="file" class="form-control" name="image" accept="image/*" />
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              Cancel
            </button>
            <button type="submit" class="btn btn-dark">
              <i class="bi bi-plus"></i> Add Product
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Edit Product Modal -->
{% for p in products %}
<div class="modal fade" id="editProduct{{ p.id }}" tabindex="-1" aria-labelledby="editProductLabel{{ p.id }}"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editProductLabel{{ p.id }}">Edit Product: {{ p.name.capitalize() }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="POST" action="{{ url_for('editProduct.editProduct', product_id=p.id) }}"
          enctype="multipart/form-data">

          <!-- Name -->
          <div class="mb-3">
            <label for="name{{ p.id }}" class="form-label">Name</label>
            <input type="text" class="form-control" id="name{{ p.id }}" name="name" value="{{ p.name }}" required>
          </div>

          <!-- Description -->
          <div class="mb-3">
            <label for="description{{ p.id }}" class="form-label">Description</label>
            <textarea class="form-control" id="description{{ p.id }}" name="description" rows="3"
              required>{{ p.description }}</textarea>
          </div>

          <!-- Price -->
          <div class="mb-3">
            <label for="price{{ p.id }}" class="form-label">Price</label>
            <input type="number" step="0.01" class="form-control" id="price{{ p.id }}" name="price"
              value="{{ p.price }}" required>
          </div>

          <!-- Stock -->
          <div class="mb-3">
            <label for="stock{{ p.id }}" class="form-label">Stock</label>
            <input type="number" class="form-control" id="stock{{ p.id }}" name="stock" value="{{ p.stock }}" required>
          </div>

          <!-- Image -->
          <div class="mb-3">
            <label for="image{{ p.id }}" class="form-label">Image URL</label>
            <input type="file" class="form-control" id="image{{ p.id }}" name="image" value="{{ p.image }}"
              accept="image/*">
          </div>

          <div class="modal-footer">
            <button type="submit" class="btn btn-dark">Save Changes</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Edit Product Modal -->
<div class="modal fade" id="deleteProduct{{ p.id }}" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Delete Product: {{ p.name.capitalize() }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this product?
      </div>
      <div class="modal-footer">
        <form action="{{ url_for('deleteProduct.deleteProduct', product_id=p.id)}}" method="POST">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger">Delete</button>
        </form>
      </div>
    </div>
  </div>
</div>

{% endfor %}
{% endblock %} {% block extra_script %}

<script src="{{ url_for('static', filename='js/jquery-3.7.1.min.js') }}"></script>

<script src="{{ url_for('static', filename='bootstrap.bundle.min.js') }}"></script>

<script src="{{ url_for('static', filename='datatables/js/datatables.min.js') }}"></script>

<script>
  // Init DataTable
  $(document).ready(function () {
    $("#productTable").DataTable({
      pageLength: 5,
      lengthMenu: [5, 10, 25, 50],
      ordering: true,
      searching: true,
      language: {
        search: '<i class="bi bi-search"></i>',
        searchPlaceholder: "Search users...",
      },
    });
  });
  // Auto-dismiss flash messages after 4 seconds
  setTimeout(() => {
    const alerts = document.querySelectorAll(".alert");
    alerts.forEach((alert) => {
      let bsAlert = new bootstrap.Alert(alert);
      bsAlert.close();
    });
  }, 4000); // 4000ms = 4 seconds
  document.addEventListener("DOMContentLoaded", () => {
    const toastElList = document.querySelectorAll(".toast");
    toastElList.forEach((toastEl) => {
      const toast = new bootstrap.Toast(toastEl, {
        delay: 3000, // hide after 3s
        autohide: true, // make sure autohide is enabled
      });
      toast.show();
    });
  });
</script>
{% endblock %}
</div>