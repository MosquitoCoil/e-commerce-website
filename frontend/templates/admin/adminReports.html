{% extends "adminBase.html" %} {% block title %}Sales Reports{% endblock %} {%
block content %}
<div class="container-fluid mt-4">
  <div class="container-sm">
    <h2 class="mb-4"><i class="bi bi-bar-chart"></i> Sales Reports</h2>

    <!-- Daily Sales Table -->
    <h4 class="mt-4">Daily Sales</h4>
    <table class="table table-bordered text-center align-middle">
      <thead class="table-dark">
        <tr>
          <th>Date</th>
          <th>Total Sales</th>
          <th>Products Sold</th>
        </tr>
      </thead>
      <tbody>
        {% for row in daily_sales %}
        <tr>
          <td>{{ row.sale_date }}</td>
          <td>₱{{ row.total_sales }}</td>
          <td>{{ row.total_products_sold }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="3" class="text-muted">No daily sales data available</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Monthly Sales Table -->
    <h4 class="mt-5">Monthly Sales</h4>
    <table class="table table-bordered text-center align-middle">
      <thead class="table-dark">
        <tr>
          <th>Month</th>
          <th>Total Sales</th>
          <th>Products Sold</th>
        </tr>
      </thead>
      <tbody>
        {% for row in monthly_sales %}
        <tr>
          <td>{{ row.sale_month }}</td>
          <td>₱{{ row.total_sales }}</td>
          <td>{{ row.total_products_sold }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="3" class="text-muted">
            No monthly sales data available
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Sales Charts -->
    <h4 class="mt-4">Daily Sales Chart</h4>
    <canvas id="dailySalesChart" height="50"></canvas>

    <h4 class="mt-5">Monthly Sales Chart</h4>
    <canvas id="monthlySalesChart" height="50"></canvas>
  </div>
</div>
{% endblock %} {% block extra_script %}
<script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/chart.min.js') }}"></script>

<!-- Embed JSON data safely -->
<script id="daily-labels" type="application/json">
  {{ daily_sales_labels|tojson }}
</script>
<script id="daily-data" type="application/json">
  {{ daily_sales_values|tojson }}
</script>
<script id="monthly-labels" type="application/json">
  {{ monthly_sales_labels|tojson }}
</script>
<script id="monthly-data" type="application/json">
  {{ monthly_sales_values|tojson }}
</script>

<script>
  // Parse embedded JSON safely
  const dailyLabels = JSON.parse(
    document.getElementById("daily-labels").textContent || "[]"
  );
  const dailyData = JSON.parse(
    document.getElementById("daily-data").textContent || "[]"
  );
  const monthlyLabels = JSON.parse(
    document.getElementById("monthly-labels").textContent || "[]"
  );
  const monthlyData = JSON.parse(
    document.getElementById("monthly-data").textContent || "[]"
  );

  // Daily Sales Chart
  new Chart(document.getElementById("dailySalesChart"), {
    type: "line",
    data: {
      labels: dailyLabels,
      datasets: [
        {
          label: "Daily Sales (₱)",
          data: dailyData,
          borderColor: "blue",
          backgroundColor: "rgba(0, 123, 255, 0.2)",
          fill: true,
          tension: 0.3,
        },
      ],
    },
    options: { responsive: true },
  });

  // Monthly Sales Chart
  new Chart(document.getElementById("monthlySalesChart"), {
    type: "bar",
    data: {
      labels: monthlyLabels,
      datasets: [
        {
          label: "Monthly Sales (₱)",
          data: monthlyData,
          backgroundColor: "rgba(40, 167, 69, 0.6)",
          borderColor: "green",
          borderWidth: 1,
        },
      ],
    },
    options: { responsive: true },
  });
</script>
{% endblock %}
